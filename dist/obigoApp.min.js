/*
obigoApp - v0.1.16
release date : 2015-11-26 

Copyright (C) OBIGO Ltd., 2015.
All rights reserved.

This software is covered by the license agreement between
the end user and OBIGO Ltd., and may be
used and copied only in accordance with the terms of the
said agreement.

OBIGO Ltd. assumes no responsibility or
liability for any errors or inaccuracies in this software,
or any consequential, incidental or indirect damage arising
out of the use of the software
*/
 function toposort(a,b){function c(g,h,i){if(i.indexOf(g)>=0)throw new Error("Cyclic dependency: "+JSON.stringify(g));if(!f[h]){f[h]=!0;var j=b.filter(function(a){return a[0]===g});if(h=j.length){var k=i.concat(g);do{var l=j[--h][1];c(l,a.indexOf(l),k)}while(h)}e[--d]=g}}for(var d=a.length,e=new Array(d),f={},g=d;g--;)f[g]||c(a[g],g,[]);return e}function uniqueNodes(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];b.indexOf(e[0])<0&&b.push(e[0]),b.indexOf(e[1])<0&&b.push(e[1])}return b}function isFunction(a){return"function"==typeof a}function bind(a,b){clickBinder(a,b)}function clickBinder(a,b){for(var c=b.querySelectorAll("*["+ATTR.CLICK+"]"),d=c.length-1;d>=0;){if(!isFunction(a.$ctrl[c[d].attributes[ATTR.CLICK].value]))throw new Error(c[d].attributes[ATTR.CLICK].value+" is not a defined function");!function(b){new ButtonHelper({evtTarget:c[b],cssName:"active",callback:function(d,e){a.$ctrl[c[b].attributes[ATTR.CLICK].value](d,e)}})}(d),d--}}function chkDupModule(a,b){if(void 0!=reservedName[a])throw new Error("Cannot use '"+a+"' name. it is reserved.");if(obigoApp.$$initPhase.$$m[a]||obigoApp.$$runPhase.$$m[a])throw new Error("Already exist module : "+a)}function makeModule(a){var b={};return"function"==typeof a?(b.$$con=a,b.$$inject=[]):a.constructor===Array&&(1==a.length?(b.$$con=a[0],b.$$inject=[]):(b.$$con=a[a.length-1],b.$$inject=a.slice(0,a.length-1))),b}function makePhase(a){var b=[];for(var c in a.$$m){var d=a.$$m[c];if(0==d.$$inject.length){var e=[];e.push(c),e.push(void 0),b.push(e)}else for(var f=0;f<d.$$inject.length;f++){var e=[];e.push(c),e.push(d.$$inject[f]),b.push(e)}}for(var g=toposort(uniqueNodes(b),b),h=g.length-1;h>=0;h--){var c=g[h];if(a.$$m[c]){for(var i=a.$$m[c].$$inject.length,j=[],f=0;i>f;f++){var k=a.$$m[c].$$inject[f];if("$ctrl"==k)a.$$m[c].$ctrl={},j.push(a.$$m[c].$ctrl);else{if(!a.$$injectable[k])throw new Error("there is no module : "+k);j.push(a.$$injectable[k])}}if("provider"==a.$$m[c].type){if(a.$$injectable[c]=a.$$m[c].$$con=a.$$m[c].$$con.apply(a.$$m[c],j),!a.$$m[c].$$con.$run)throw new Error("Provider have to define '$run' property : "+c);obigoApp.createFactory(c.substring(0,c.length-PROVIDER_SUFFIX.length),a.$$m[c].$$con.$run)}else"factory"==a.$$m[c].type?a.$$injectable[c]=a.$$m[c].$$con=a.$$m[c].$$con.apply(a.$$m[c],j):"controller"==a.$$m[c].type?(a.$$m[c].$$con.apply(a.$$m[c],j),bind(a.$$m[c],document.querySelector("*["+ATTR.CTRL+"="+c+"]"))):a.$$m[c].$$con.apply(a.$$m[c],j)}}}var PROVIDER_SUFFIX="Provider",RUN_MODULE_NAME="$$commonM",ATTR={ELEM:"ob-elem",TITLE:"ob-title",CTRL:"ob-ctrl",CLICK:"ob-click",LIST:"ob-list"},reservedName={$$initM:"$$initM",$$commonM:"$$commonM"},obigoApp={};obigoApp.$$initPhase={$$m:{},$$injectable:{}},obigoApp.$$runPhase={$$m:{},$$injectable:{}},obigoApp.createController=function(a,b){var c="controller";return chkDupModule(a,c),obigoApp.$$runPhase.$$m[a]=makeModule(b),obigoApp.$$runPhase.$$m[a].type=c,this},obigoApp.createFactory=function(a,b){var c="factory";return chkDupModule(a,c),obigoApp.$$runPhase.$$m[a]=makeModule(b),obigoApp.$$runPhase.$$m[a].type=c,obigoApp.$$runPhase.$$injectable[a]=obigoApp.$$runPhase.$$m[a].$$con,this},obigoApp.createProvider=function(a,b){var c="provider";return chkDupModule(a,c),a+=PROVIDER_SUFFIX,obigoApp.$$initPhase.$$m[a]=makeModule(b),obigoApp.$$initPhase.$$m[a].type=c,obigoApp.$$initPhase.$$injectable[a]=obigoApp.$$initPhase.$$m[a].$$con,this},obigoApp.init=function(a){var b=reservedName.$$initM,c="init";if(obigoApp.$$initPhase.$$m[b])throw new Error("Already exist : init");return obigoApp.$$initPhase.$$m[b]=makeModule(a),obigoApp.$$initPhase.$$m[b].type=c,this},obigoApp.common=function(a){var b=reservedName.$$commonM,c="common";if(obigoApp.$$runPhase.$$m[b])throw new Error("Already exist : common");return obigoApp.$$runPhase.$$m[b]=makeModule(a),obigoApp.$$runPhase.$$m[b].type=c,this},obigoApp.createProvider("$ajax",[function(){var a={timeout:25e3};return{prop:a,$run:["$promise",function(b){function c(c){var d={success:void 0,error:void 0,method:"GET",url:"",header:{},timeout:a.timeout};for(var e in c)d[e]=c[e];return b.p(function(a,b){obigo.ajax({url:d.url,type:d.method,timeout:d.timeout,requestHeader:d.header,success:function(){var b={response:arguments[0],status:arguments[1],xhr:arguments[2]};isFunction(d.success)?d.success(b):a(b)},error:function(){var a={xhr:arguments[0],response:arguments[1],status:arguments[2]};isFunction(d.error)?d.error(a):b(a)}})})}return{req:c}}]}}]),obigoApp.createProvider("$elem",[function(){var a={},b={disable:"dis"},c=0,d=document.querySelectorAll("*["+ATTR.ELEM+"]"),e=function(a){var c={};return c.o=a,c.hide=function(){this.o.style.display="none"},c.show=function(){this.o.style.display="block"},c.setText=function(a){this.o.textContent=a},c.setWidth=function(a){this.o.style.width=a},c.setHeight=function(a){this.o.style.height=a},c.setDisable=function(){this.o.classList.add(b.disable),this.o.style.pointerEvents="none"},c.setEnable=function(){this.o.classList.remove(b.disable),this.o.style.pointerEvents="auto"},c};for(c=d.length-1;c>=0;){if(void 0!=a[d[c].attributes[ATTR.ELEM].value])throw new Error("Duplicate attribute value for ob-elem : "+d[c].attributes[ATTR.ELEM].value);a[d[c].attributes[ATTR.ELEM].value]=e(d[c]),c--}return{prop:{e:a,wrap:e,css:b},$run:function(){return{e:a,wrap:e}}}}]),obigoApp.createProvider("$list",["$templateProvider",function(a){var b={},c=0,d=function(b){var c={};return c.o=b,c.update=function(b){var c=this.o.children.length;if(0==c)for(var d=0;d<b.listItem.length;d++){var e=a.get(this.id);b.callback(d,b.listItem[d],e.firstElementChild),this.o.appendChild(e)}else{var f=0,g=0;for(g=0;g<b.listItem.length&&c>f;g++,f++){var h=this.o.children[f],i=a.get(this.id).firstElementChild;b.callback(g,b.listItem[g],i),h.parentNode.replaceChild(i,h)}if(g==b.listItem.length)for(;this.o.children[g-1].nextElementSibling;)this.o.removeChild(this.o.children[g-1].nextElementSibling);else for(var d=g;d<b.listItem.length;d++){var e=a.get(this.id);b.callback(d,b.listItem[d],e.firstElementChild),this.o.appendChild(e)}}},c},e=document.querySelectorAll("*["+ATTR.LIST+"]");for(c=e.length-1;c>=0;){var f=void 0,g=e[c].attributes[ATTR.LIST].value;if(b[g]=d(e[c]),f=e[c].querySelector("template"),!f)throw new Error("'ob-list' must have a template element.");var h="list_"+g+"_"+(new Date).getTime();a.set(h,f),b[g].template=f,b[g].id=h,e[c].innerHTML="",c--}return{$run:function(){return{l:b}}}}]),obigoApp.createProvider("$log",[function(){function a(a,e){if(!(0==d.show||c[a]>c[d.level])){var f=new RegExp("[a-z0-9_]+.js:[0-9]+","gi"),g=(new Error).stack,h=g.match(f),i=h[2];console[a](b(a,i)+e)}}function b(a,b){var c=new Date,d=c.toISOString();return d=d.slice(11,23),d+"	"+a.toUpperCase()+"	"+b+"	---- "}var c={error:0,warn:1,info:2,debug:3},d={level:"debug",show:!0};return{prop:d,fatal:function(a){throw new Error(a)},error:function(b){a("error",b)},warn:function(b){a("warn",b)},info:function(b){a("info",b)},debug:function(b){a("debug",b)},$run:function(){return{fatal:function(a){throw new Error(a)},error:function(b){a("error",b)},warn:function(b){a("warn",b)},info:function(b){a("info",b)},debug:function(b){a("debug",b)}}}}}]),obigoApp.createProvider("$pager",["$elemProvider",function(a){for(var b={},c={},d=[],e={},f=void 0,g=void 0,h={},i=document.querySelector("*["+ATTR.TITLE+"]"),j=function(a){void 0==a&&(a="");try{i.innerHTML=a}catch(b){}},k=document.querySelectorAll("*["+ATTR.CTRL+"]"),l={},m=k.length-1;m>=0;)l[k[m].attributes[ATTR.CTRL].value]=a.prop.wrap(k[m]),m--;return h.createPage=function(a){if(a.ctrl){if(!l[a.ctrl])throw new Error("Controller is not defined : "+a.ctrl);a.elem=l[a.ctrl],c[a.ctrl]=a}return b[a.name]=a,1==a.initPage?(b[a.name].elem.show(),f=b[a.name],j(f.title)):b[a.name].elem.hide(),1==a.lastPage&&(e[a.name]=!0),h},h.setOffCallback=function(a){g=a},h.$run=[function(){return{getCurrentPage:function(){return f.name},getPageTitle:function(){return i.innerHTML},setPageTitle:j,go:function(a,c){var e,g;if(void 0!=c&&(e=c.param||void 0,g=c.title||""),f!=b[a]){for(var h in b)h!=a?b[h].elem.hide():b[h].elem.show();for(var i=0;i<d.length;i++)if(d[i].name==f.name){d.splice(i,d.length);break}f.noHistory||d.push(f),f.onUnload&&window.obigoApp.$$runPhase.$$m[f.ctrl].$ctrl[f.onUnload](),f=b[a]}""!=g&&void 0!=g||!b[a].title?""!=g&&void 0!=g&&j(g):j(b[a].title),b[a].onLoad&&window.obigoApp.$$runPhase.$$m[b[a].ctrl].$ctrl[b[a].onLoad](e)},back:function(){var a=d.pop();if(1==e[f.name]||void 0==a)void 0!=g&&g(),AppManager.back();else{for(var c in b)c!=a.name?b[c].elem.hide():b[c].elem.show();if(f.onUnload){var h=b[f.name];window.obigoApp.$$runPhase.$$m[h.ctrl].$ctrl[h.onUnload]()}f=a,j(f.title),a.onShowByBack&&window.obigoApp.$$runPhase.$$m[a.ctrl].$ctrl[a.onShowByBack]()}}}}],h}]),obigoApp.createProvider("$progress",function(){function a(){return f}function b(a){a=a||{};var b=a.onTimeout||g.onDefaultTimeout,h=a.text||" ";void 0!=b&&(void 0!=e&&clearTimeout(e),e=setTimeout(function(){c(),b()},g.timeout)),d.changeMsg(h),d.show(),f=!0}function c(){clearTimeout(e),d.hide(),f=!1}var d=new obigo.loading(" "),e=void 0,f=!1,g={timeout:15e3,onDefaultTimeout:function(){obigo.message({title:"No response",button:["Close"]})}};return{prop:g,show:b,hide:c,$run:function(){return{show:b,hide:c,isShow:a}}}}),obigoApp.createProvider("$promise",[function(){var a={};return{prop:a,$run:function(){function a(a){return Promise.all(a)}function b(a){return new Promise(function(b,c){a(b,c)})}return{p:b,all:a}}}}]),obigoApp.createProvider("$template",[function(){function a(a,b){a=c+a;var e=void 0;"string"==typeof b?(e=document.createElement("template"),e.setAttribute("id",a),e.innerHTML=b,document.body.appendChild(e)):e=b,d[a]=e}function b(a){return a=c+a,d[a].content.cloneNode(!0)}var c="$$obigo_",d={};return{set:a,get:b,$run:function(){return{get:b}}}}]),window.addEventListener("load",function(a){makePhase(obigoApp.$$initPhase),makePhase(obigoApp.$$runPhase)}),window.obigoApp=obigoApp;